// Define the database connection; connect, read and save
var apiConnection = function (lat, lng) {
	Ti.API.info("apiConnection");
	var url = "http://api.wunderground.com/api/1ca3f32c8865e443/geolookup/conditions/alerts/forecast/hourly/q/" + lat + "," + lng + ".json";
	var xhrRequest = Ti.Network.createHTTPClient ({
		onload : function(e) {
			console.log(e);
			var json = JSON.parse(this.reponseText);
			console.log(json);
		},
		onerror : function(e) {
			console.log(e);
		},
		timeout : 5000
	});
	
	xhrRequest.open("GET", url);
	xhrRequest.send();
};

var getGeo = function() {
	Ti.Geolocation.getCurrentPosition(function(e) {
		if (!e.success || e.error) {
			console.log(e.error);
			alert("Sorry there was an error getting your current location.");
		} else {
			var lat = e.coords.latitude;
			var lng = e.coords.longitude;
			apiConnection(lat, lng);
		}
	});
};

var read = function() {
	
};

var save = function () {
	
};

exports.getGeo = getGeo;