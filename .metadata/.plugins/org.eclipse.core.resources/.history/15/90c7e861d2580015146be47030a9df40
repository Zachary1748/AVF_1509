// Define all design elements to be displayed within the application
var fntFmly = "Arial";

var mainWin = Ti.UI.createWindow ({
	title: "Weather",
	backgroundColor: "#ededed",
	layout: "vertical"
});

if (!Ti.Platform.osname === "android") {
	var statusBar = Ti.UI.createView({
		height: 20, left: 0, right: 0, top: 0,
		backgroundColor: "#ededed"
	});
	
	mainWin.add(statusBar);
}

var alertView = Ti.UI.createView ({
	backgroundColor: "#e60000",
	left: 0, right: 0, top: 20
});
var alertText = Ti.UI.createLabel ({
	color: "#FFFFFF",
	font: {fontSize: 12, fontFamily: fntFmly}
});
alertView.add(alertText);

var tempView = Ti.UI.createView ({
	left: 0, right: 0, height: "50%",
	backgroundColor: "#ffffff",
	layout: "vertical"
});

var refreshImg = Ti.UI.createImageView ({
	image: "images/refresh.png",
	height: 15, top: 5, right: 5
});
tempView.add(refreshImg);

var wthrImg = Ti.UI.createImageView ({
	image: "?",
	height: 50
});
tempView.add(wthrImg);

var weatherStatus = Ti.UI.createLabel ({
	text: "?",
	color: "#A6A6A6", top: 0,
	font: {fontFamily: fntFmly, fontSize: 14}
});
tempView.add(weatherStatus);

var tempText = Ti.UI.createLabel ({
	text: "?",
	top: 10,
	color: "#333333",
	font: {fontSize: 66, fontFamily: fntFmly}
});
tempView.add(tempText);

var locationText = Ti.UI.createLabel ({
	text: "?, ?",
	top: 5, color: "#5c5c5c",
	font: {fontSize: 16, fontFamily: fntFmly},
	textAlign: "center"
});
tempView.add(locationText);

var threeDayForecast = Ti.UI.createView({
	left: 0, top: 0,
	backgroundColor: "#FFFFFF"
});

var oneDayLabel = Ti.UI.createLabel ({
	text: "????????", bottom: 0,
	font: { fontSize: 18, fontFamily: fntFmly }
});
threeDayForecast.add(oneDayLabel);

var alerts = require("alerts");

var updateView = function(response) {
	wthrImg.image = response.wthrImg;
	weatherStatus.text = response.wthr;
	tempText.text = response.temp + "Â°";
	locationText.text = response.city + ", " + response.state + "\n" + response.zip + ", " + response.ctry;
	console.log(response.city + ", " + response.state);
	if (response.desc == null) {
		alertView.height = 0;
	} else {
		alertText.text = response.desc;
		alertText.top = 2;
		alertView.height = 20;
		
		alertView.addEventListener("click", function(){
			alerts.infoWin.open();
			alerts.infoText.text = response.desc + response.msg;
		});
	}
};

// Refresh data
refreshImg.addEventListener('click', function(){
	if (Ti.Network.online) {
		// Connect to the API and send results to the Ui and DB
		var api = require("api");
		api.getGeo();
	} else {
		// Connect to the DB if the user has been opened the application before with internet
		alert("Please connect to the internet.");
	}
});

if (Ti.Platform.osname === "android") {
	alertView.top = 0;
}

mainWin.add(alertView);
mainWin.add(tempView);
mainWin.add(threeDayForecast);
mainWin.open();
exports.updateView = updateView;
