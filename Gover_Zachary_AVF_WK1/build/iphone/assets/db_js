var send=function(e){var t=require("ui");t.updateView(e)},apiConnection=function(e,t){Ti.API.info("apiConnection");var r="http://api.wunderground.com/api/1ca3f32c8865e443/geolookup/conditions/alerts/forecast/hourly/q/"+e+","+t+".json",a=Ti.Network.createHTTPClient({onload:function(){var e=JSON.parse(this.responseText),t={ctry:e.location.country,state:e.location.state,city:e.location.city,zip:e.location.zip,wthrImg:e.current_observation.icon_url,wthr:e.current_observation.weather,temp:Math.round(e.current_observation.temp_f)};save(t),read()},onerror:function(e){console.log(e),alert("There was an error while retreiving the weather data.")},timeout:5e3});a.open("GET",r),a.send()},getGeo=function(){Ti.Geolocation.getCurrentPosition(function(e){if(!e.success||e.error)console.log(e.error),alert("Sorry there was an error getting your current location.");else{var t=e.coords.latitude,r=e.coords.longitude;apiConnection(t,r)}})},read=function(){for(var e=Ti.Database.open("weather_db"),t=e.execute("SELECT * FROM weather_data");t.isValidRow();){var r={id:t.fieldByName("id"),ctry:t.fieldByName("ctry"),state:t.fieldByName("state"),city:t.fieldByName("city"),zip:t.fieldByName("zip"),wthrImg:t.fieldByName("wthrImg"),wthr:t.fieldByName("wthr"),temp:t.fieldByName("temp")};t.next()}t.close(),e.close(),send(r)},save=function(e){var t=Ti.Database.open("weather_db");t.execute("CREATE TABLE IF NOT EXISTS weather_data (id INTEGER PRIMARY KEY, ctry TEXT, state TEXT, city TEXT, zip INTEGER, wthrImg TEXT, wthr TEXT, temp TEXT)"),t.execute("DELETE FROM weather_data"),t.execute("INSERT INTO weather_data (ctry, state, city, zip, wthrImg, wthr, temp) VALUES (?, ?, ?, ?, ?, ?, ?)",e.ctry,e.state,e.city,e.zip,e.wthrImg,e.wthr,e.temp),t.close()};exports.getGeo=getGeo,exports.read=read;